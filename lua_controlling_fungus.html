<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Fungus: Controlling Fungus</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-59839218-1', 'auto');
  ga('send', 'pageview');
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color: #B7CEEC;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://fungusgames.com" target="_blank"><img alt="Logo" src="logo_small.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><!--Fungus-->
   &#160;<span id="projectnumber"><!--v3.6.1--></span>
   </div>
   <div id="projectbrief">v3.6.1 Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lua_controlling_fungus.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Controlling Fungus </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#narrative_example">Narrative example</a></li>
<li class="level1"><a href="#say_dialog_functions">Say Dialog functions</a></li>
<li class="level1"><a href="#menu_dialog_functions">Menu Dialog functions</a></li>
<li class="level1"><a href="#portrait_functions">Portrait functions</a></li>
<li class="level1"><a href="#conversation_function">Conversation function</a></li>
<li class="level1"><a href="#flowchart_functions">Flowchart functions</a></li>
</ul>
</div>
<div class="textblock"><p>The Fungus module provides several functions for working with the standard Fungus narrative features and flowcharts.</p>
<p>You can control Say and Menu dialogs in much the same way you use Say and Menu commands in a normal Fungus flowchart.</p>
<p>When you use the menu() function, you supply another Lua function to call when that menu option is selected. Make sure to define the function higher up in the file before referencing it in a menu() call. If you don't explicitly set a SayDialog or MenuDialog object to use default ones are created automatically.</p>
<h1><a class="anchor" id="narrative_example"></a>
Narrative example</h1>
<p>This example Lua script demonstrates some of the Say and Menu dialog functions. To try it out, add a Lua object to the scene (Tools &gt; Fungus &gt; Create &gt; Lua) and copy this script into the Lua Script text box. You may also need to add an EventSystem object in the scene (GameObject &gt; UI &gt; Event System) so that the menu buttons will respond to user input.</p>
<div class="fragment"><div class="line">-- Display text in a SayDialog</div><div class="line">say(&quot;Hi there&quot;)</div><div class="line">say &quot;This syntax also works for say commands&quot;</div><div class="line"></div><div class="line">-- Display a list of options in a MenuDialog</div><div class="line">-- (Note the curly braces here!)</div><div class="line">local choice = choose{ &quot;Go left&quot;, &quot;Go right&quot; }</div><div class="line"></div><div class="line">if choice == 1 then</div><div class="line">    say(&quot;You chose left&quot;)</div><div class="line">elseif choice == 2 then</div><div class="line">    say(&quot;You chose right&quot;)</div><div class="line">end</div></div><!-- fragment --><p>Note: The curly braces syntax means that the list of options is passed as a single table parameter to the choose() function. It's a shortcut for writing this: </p><div class="fragment"><div class="line">local choice = choose( {&quot;Go left&quot;, &quot;Go right&quot;} )</div></div><!-- fragment --><h1><a class="anchor" id="say_dialog_functions"></a>
Say Dialog functions</h1>
<p>To use a custom SayDialog:</p>
<ol type="1">
<li>Add as SayDialog to the scene (Tools &gt; Fungus &gt; Create &gt; SayDialog)</li>
<li>Select the Lua object in the hierarchy and find the LuaBindings component.</li>
<li>Add a binding to the SayDialog game object, and select the SayDialog component. N.B. Make sure to select the correct component!</li>
<li>In Lua script, you can now activate this SayDialog using the setsaydialog() function, by passing the key of the SayDialog binding.</li>
</ol>
<p>To change the behaviour of the say() function, e.g. to not wait for input when done, do this: </p><div class="fragment"><div class="line">sayoptions.waitforinput = false</div></div><!-- fragment --><p>You can bind Character objects in a similar fashion, and set the speaking character using the setcharacter() function.</p>
<p>This is the list of available functions for controlling SayDialogs.</p>
<div class="fragment"><div class="line">-- Options for configuring Say Dialog behaviour</div><div class="line">sayoptions.clearprevious = true | false</div><div class="line">sayoptions.waitforinput = true | false</div><div class="line">sayoptions.fadewhendone = true | false</div><div class="line">sayoptions.stopvoiceover = true | false</div><div class="line"></div><div class="line">-- Set the active saydialog to use with the say function</div><div class="line">-- saydialog: A binding to a SayDialog component</div><div class="line">setsaydialog(saydialog)</div><div class="line"></div><div class="line">-- Gets the active say dialog, or creates one if none exists yet</div><div class="line">getsaydialog()</div><div class="line"></div><div class="line">-- Set the active character on the Say Dialog</div><div class="line">-- character: A Fungus.Character component</div><div class="line">-- portrait: The name of a sprite in the character&#39;s portrait list</div><div class="line">setcharacter(character, portrait)</div><div class="line"></div><div class="line">-- Write text to the active Say Dialog</div><div class="line">-- text: A string to write to the say dialog</div><div class="line">-- voice: A voiceover audioclip to play</div><div class="line">say(text, voiceclip)</div></div><!-- fragment --><h1><a class="anchor" id="menu_dialog_functions"></a>
Menu Dialog functions</h1>
<p>You setup custom MenuDialogs in the same manner as SayDialogs, use the setmenudialog() function to set the active MenuDialog.</p>
<p>The easiest way to display a list of options is using the choose() function. Remember that in Lua array indices start at 1 instead of 0 like in most other languages.</p>
<p>You can set an option to be displayed but not selectable by prepending it with the ~ character.</p>
<div class="fragment"><div class="line">local choice = choose { &quot;Option 1&quot;, &quot;Option 2&quot;, &quot;~Option 3&quot; } </div><div class="line"></div><div class="line">if choice == 1 then </div><div class="line">    say &quot;Chose option 1&quot;</div><div class="line">elseif choice == 2 then </div><div class="line">    say &quot;Chose option 2&quot;</div><div class="line">end</div><div class="line">-- Option 3 is displayed but can&#39;t be selected</div><div class="line"></div><div class="line">say &quot;End options&quot;</div></div><!-- fragment --><p>A useful pattern is to use choose() together with Lua's goto statement and labels. This can be handy for 'flattening out' nested menu options. The <a href="http://lua-users.org/wiki/GotoStatement">goto statement</a> doesn't support jumping into the scope of a local variable, but it's easy to work around this by declaring the local variable in the outer scope. You could also use a global variable (by not using the local keyword).</p>
<div class="fragment"><div class="line">local choice = 0</div><div class="line"></div><div class="line">choice = choose { &quot;Option A&quot;, &quot;Option B&quot; } </div><div class="line">if choice == 1 then goto optionA end</div><div class="line">if choice == 2 then goto optionB end</div><div class="line"></div><div class="line">::optionA::</div><div class="line">say &quot;Chose option A&quot;</div><div class="line">goto endoptions</div><div class="line"></div><div class="line">::optionB::</div><div class="line">choice = choose { &quot;Option C&quot;, &quot;Option D&quot; } </div><div class="line">if choice == 1 then goto optionC end</div><div class="line">if choice == 2 then goto optionD end</div><div class="line">goto endoptions</div><div class="line"></div><div class="line">::optionC::</div><div class="line">say &quot;Chose option C&quot;</div><div class="line">goto endoptions</div><div class="line"></div><div class="line">::optionD::</div><div class="line">say &quot;Chose option D&quot;</div><div class="line">goto endoptions</div><div class="line"></div><div class="line">::endoptions::</div><div class="line">say &quot;End options&quot;</div></div><!-- fragment --><p>The menu() and menutimer() functions provide an alternative way to use the MenuDialog. These functions return immediately, and a callback function is called when the player selects an option from the menu.</p>
<p>This is the list of available MenuDialog functions.</p>
<div class="fragment"><div class="line">-- Set the active menudialog to use with the menu function</div><div class="line">setmenudialog(menudialog)</div><div class="line"></div><div class="line">-- Gets the active menu dialog, or creates one if none exists yet</div><div class="line">getmenudialog()</div><div class="line"></div><div class="line">-- Display a list of menu options and wait for user to choose one.</div><div class="line">-- When an option starts with the ~ character it will be displayed but not be selectable.</div><div class="line">-- Returns the index of the selected option.</div><div class="line">-- Returns 0 if options list is empty. Note: Lua array indices start at 1, not 0).</div><div class="line">-- options: an array of option strings. e.g. { &quot;Option 1&quot;, &quot;Option 2&quot; }</div><div class="line">choose(options)</div><div class="line"></div><div class="line">-- Display a list of menu options and wait for user to choose one, or for a timer to expire.</div><div class="line">-- When an option starts with the ~ character it will be displayed but not be selectable.</div><div class="line">-- Returns the index of the selected option, or the defaultoption if the timer expires.</div><div class="line">-- Returns 0 if options list is empty. Note: Lua array indices start at 1, not 0).</div><div class="line">-- options: an array of option strings. e.g. { &quot;Option 1&quot;, &quot;Option 2&quot; }</div><div class="line">-- duration: Time player has to pick an option.</div><div class="line">-- defaultoption: Option index to return if the timer expires.</div><div class="line">choosetimer(options, duration, defaultoption)</div><div class="line"></div><div class="line">-- Display a menu button</div><div class="line">-- text: text to display on the button</div><div class="line">-- callback: function to call when this option is selected</div><div class="line">-- interactive (optional): if false, displays the option as disabled</div><div class="line">menu(text, callback, interactive)</div><div class="line"></div><div class="line">-- Display a timer during which the player has to choose an option.</div><div class="line">-- duration: The length of time to display the timer.</div><div class="line">-- callback: Function to call if the timer expires before an option is selected.</div><div class="line">menutimer(duration, callback)</div><div class="line"></div><div class="line">-- Clear all currently displayed menu options</div><div class="line">clearmenu()</div></div><!-- fragment --><h1><a class="anchor" id="portrait_functions"></a>
Portrait functions</h1>
<p>Stage portraits can be controlled by using the stage.</p>
<p>First, add your characters and stage to the LuaBindings list.</p>
<div class="image">
<img src="lua_stage_binding.png" alt="lua_stage_binding.png"/>
</div>
<p>Then, in a lua script, use the stage commands show, showPortrait and hide to control the portraits on stage.</p>
<div class="fragment"><div class="line">-- Show a character at this stage position</div><div class="line">stage.show(character, &quot;left&quot;)</div><div class="line"></div><div class="line">-- show a character with a specific portrait and move it</div><div class="line">-- from one stage position to another.</div><div class="line">stage.show(character, &quot;happy&quot;, &quot;offscreen right&quot;, &quot;right&quot;)</div><div class="line"></div><div class="line">-- show a specific portrait</div><div class="line">stage.showPortrait(character, &quot;amused&quot;)</div><div class="line"></div><div class="line">-- hide a character</div><div class="line">stage.hide(character)</div><div class="line"></div><div class="line">-- Hide a character fading out to a position</div><div class="line">stage.hide(character, &quot;offscreen left&quot;)</div></div><!-- fragment --><p> You can also specify any Portrait option available by using named arguments.</p>
<div class="fragment"><div class="line">stage.show{character=character, fromPosition=&quot;left&quot;, toPosition=&quot;right&quot;}</div><div class="line"></div><div class="line">stage.show{character=character, portrait=&quot;angry&quot;, facing=&quot;left&quot;}</div><div class="line"></div><div class="line">stage.hide{character=character}</div></div><!-- fragment --><h1><a class="anchor" id="conversation_function"></a>
Conversation function</h1>
<p>The conversation() function allows you to perform long dialogue exchanges with a single function call. Lua's multiline string syntax [[ ]] is handy here. As the conversation() function takes a single string parameter you can also omit the usual function parentheses.</p>
<div class="fragment"><div class="line">conversation [[</div><div class="line">john: Hello!</div><div class="line">sherlock: Greetings.</div><div class="line">]]</div></div><!-- fragment --><p>See the docs for the <a class="el" href="conversation_system.html">Conversation system</a>.</p>
<h1><a class="anchor" id="flowchart_functions"></a>
Flowchart functions</h1>
<p>We've added special functions for say() and menu() because these are so common in Fungus games. To execute any other commands in Fungus from Lua, you must do it in conjunction with a Flowchart &amp; Block, like this:</p>
<ol type="1">
<li>Add a Flowchart and a Block (e.g. "MyBlock") in the scene.</li>
<li>Add the Fungus commands you want to execute from Lua in the Block. (e.g Play Sound)</li>
<li>Add a Lua object to the scene (Tools &gt; Fungus &gt; Create &gt; Lua)</li>
<li>In the LuaBindings component, add a binding to the Flowchart gameobject, and select the Flowchart component.</li>
<li>In the LuaScript component, use the runblock() function to execute the Block, passing the bound flowchart and name of the block as parameters.</li>
</ol>
<div class="fragment"><div class="line">runblock(flowchart, &quot;MyBlock&quot;)</div></div><!-- fragment --><p>You can also access any Flowchart variable from Lua via the getvar() function.</p>
<div class="fragment"><div class="line">-- Assume the &#39;flowchart&#39; variable is bound to a Flowchart component in LuaBindings</div><div class="line">-- MyVar is a string variable defined on the Flowchart</div><div class="line"></div><div class="line">local myvar = getvar(flowchart, &quot;MyVar&quot;)</div><div class="line"></div><div class="line">print(myvar.value)</div><div class="line"></div><div class="line">myvar.value = &quot;New value for string&quot;</div></div><!-- fragment --><p>This is the list of available functions for controlling Flowcharts.</p>
<div class="fragment"><div class="line">-- Returns the specified Variable in a Flowchart.</div><div class="line">-- To access the value of the variable, use its .value property. e.g.</div><div class="line">--  v = getvar(flowchart, &quot;FloatVar&quot;)</div><div class="line">--  v.value = 10    -- Sets the value of the variable to 10</div><div class="line">--  f = v.value     -- f now contains 10</div><div class="line">-- flowchart: The Fungus Flowchart containing the Block to run.</div><div class="line">-- varname: The name of the Variable to get.</div><div class="line">getvar(flowchart, varname)</div><div class="line"></div><div class="line">-- Runs the specified Block in a Flowchart</div><div class="line">-- flowchart: The Fungus Flowchart containing the Block to run.</div><div class="line">-- blockname: The name of the Block to run.</div><div class="line">-- commandindex: Index of the command to start execution at</div><div class="line">-- nowait: If false, will yield until the Block finishes execution. If true will continue immediately.</div><div class="line">runblock(flowchart, blockname, commandindex, nowait)</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="fungus_lua.html">Fungus Lua</a></li>
    <li class="footer">Generated on Tue Apr 3 2018 23:20:21 for Fungus by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
