<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://fungusgames.com/fungus_lua/lua_utils/index.html">
        <link rel="shortcut icon" href="../../images/favicon.ico">
        

	<title>Lua Utils - Fungus</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70024522-1', 'auto');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" style="padding: 2px 0px 2px 0px;" href="../../index.html"><img src="../../images/logo_100.png" style='height: 50px;'></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Fungus Docs <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../index.html">Overview</a>
</li>

                    
                        
<li >
    <a href="../../about/index.html">What is Fungus?</a>
</li>

                    
                        
<li >
    <a href="../../download/index.html">Installation</a>
</li>

                    
                        
<li >
    <a href="../../getting_started/index.html">Getting Started</a>
</li>

                    
                        
<li >
    <a href="../../flowcharts/index.html">Flowcharts</a>
</li>

                    
                        
<li >
    <a href="../../blocks/index.html">Blocks</a>
</li>

                    
                        
<li >
    <a href="../../telling_a_story/index.html">Telling a Story</a>
</li>

                    
                        
<li >
    <a href="../../playing_audio/index.html">Playing Audio</a>
</li>

                    
                        
<li >
    <a href="../../articles/index.html">Community Articles</a>
</li>

                    
                        
<li >
    <a href="../../glossary/index.html">Glossary</a>
</li>

                    
                        
<li >
    <a href="../../faq/index.html">FAQ</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Reference</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../commands/animation_commands/index.html">Animation Commands</a>
</li>

        
            
<li >
    <a href="../../commands/audio_commands/index.html">Audio Commands</a>
</li>

        
            
<li >
    <a href="../../commands/camera_commands/index.html">Camera Commands</a>
</li>

        
            
<li >
    <a href="../../commands/flow_commands/index.html">Flow Commands</a>
</li>

        
            
<li >
    <a href="../../commands/itween_commands/index.html">iTween Commands</a>
</li>

        
            
<li >
    <a href="../../commands/narrative_commands/index.html">Narrative Commands</a>
</li>

        
            
<li >
    <a href="../../commands/scripting_commands/index.html">Scripting Commands</a>
</li>

        
            
<li >
    <a href="../../commands/sprite_commands/index.html">Sprite Commands</a>
</li>

        
            
<li >
    <a href="../../commands/variable_commands/index.html">Variable Commands</a>
</li>

        
            
<li >
    <a href="../../commands/event_handlers/core_events/index.html">Events (Core) Commands</a>
</li>

        
            
<li >
    <a href="../../commands/event_handlers/input_events/index.html">Events (Input) Commands</a>
</li>

        
            
<li >
    <a href="../../commands/event_handlers/sprite_events/index.html">Events (Sprite) Commands</a>
</li>

        
            
<li >
    <a href="../../advanced/narrative_parser_tokens/index.html">Narrative Parser Tokens</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">FungusLua Docs (Beta) <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../index.html">Overview</a>
</li>

                    
                        
<li >
    <a href="../create_menu/index.html">Create Menu</a>
</li>

                    
                        
<li >
    <a href="../lua_environment/index.html">Lua Environment</a>
</li>

                    
                        
<li >
    <a href="../lua_bindings/index.html">Lua Bindings</a>
</li>

                    
                        
<li >
    <a href="../lua_script/index.html">Lua Script</a>
</li>

                    
                        
<li class="active">
    <a href="index.html">Lua Utils</a>
</li>

                    
                        
<li >
    <a href="../fungus_module/index.html">Fungus Module</a>
</li>

                    
                        
<li >
    <a href="../controlling_fungus/index.html">Controlling Fungus</a>
</li>

                    
                        
<li >
    <a href="../execute_lua/index.html">ExecuteLua command</a>
</li>

                    
                        
<li >
    <a href="../preferences/index.html">Preferences</a>
</li>

                    
                        
<li >
    <a href="../lua_store/index.html">Lua Store</a>
</li>

                    
                        
<li >
    <a href="../string_table/index.html">String Table</a>
</li>

                    
                        
<li >
    <a href="../unity_test_tools/index.html">Unity Test Tools</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../tutorial_videos/index.html">Tutorial Videos</a>
                </li>
            
            
            
                <li >
                    <a href="../../training_course/index.html">Training Course</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://fungusgames.com">FungusGames.com</a>
                </li>
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <!--
                <li >
                    <a rel="next" href="../lua_script/index.html">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../fungus_module/index.html">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                -->
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#luautils">LuaUtils</a></li>
        
    
        <li class="main "><a href="#example">Example</a></li>
        
    
        <li class="main "><a href="#gameobject-functions">GameObject Functions</a></li>
        
    
        <li class="main "><a href="#registering-c-types">Registering C# Types</a></li>
        
    
        <li class="main "><a href="#example-json-type-file">Example JSON Type File</a></li>
        
    
        <li class="main "><a href="#registering-types-directly">Registering Types Directly</a></li>
        
    
        <li class="main "><a href="#other-utilities">Other Utilities</a></li>
        
    
        <li class="main "><a href="#podfactory">PODFactory</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="luautils">LuaUtils</h1>
<p>LuaUtils is a component that extends the Lua environment with some commonly used functionality. </p>
<p>It can be accessed from Lua scripts via the 'luautils' global variable. This component mostly does a lot of setup work in the background, but it also provides some handy functions for instantiating, finding and destroying gameobjects in the scene.</p>
<h1 id="example">Example</h1>
<p>Here's an example of the kind of thing you can do:</p>
<pre><code class="lua">local go = luautils.Find(&quot;MyObject&quot;) -- Find a game object by name
luautils.Destroy(go) -- Destroy it
</code></pre>

<h1 id="gameobject-functions">GameObject Functions</h1>
<p>This is the list of GameObject functions provided in luautils.</p>
<pre><code class="lua">-- Find a game object by name and returns it.
GameObject Find(string name)

-- Returns one active GameObject tagged tag. Returns null if no GameObject was found.
GameObject FindWithTag(string tag)

-- Returns a list of active GameObjects tagged tag. Returns empty array if no GameObject was found.
GameObject[] FindGameObjectsWithTag(string tag)

-- Create a copy of a GameObject.
-- Can be used to instantiate prefabs.
GameObject Instantiate(GameObject go)

-- Destroys an instance of a GameObject.
Destroy(GameObject go)

-- Spawns an instance of a named prefab resource.
-- The prefab must exist in a Resources folder in the project.
GameObject Spawn(string resourceName)
</code></pre>

<h1 id="registering-c-types">Registering C# Types</h1>
<p>The most important function of the LuaUtils component is registering C# types so that instances of those types can be accessed from Lua scripts. </p>
<p>In order to access the members of a C# type from Lua, the type first has to be registered with MoonSharp. Note that for objects added using the LuaBindings component, the relevant types are registered automatically.</p>
<p>In some cases however, you will need to register a type explicitly. The easiest way to do this is by adding the type's name to the FungusTypes.txt or UnityTypes.txt JSON files referenced by the LuaUtils component. You can also create your own JSON files to register additional types. Note that types that are not contained in the main application DLL will need to use the <a href="https://msdn.microsoft.com/en-us/library/system.type.assemblyqualifiedname(v=vs.110).aspx">namespace qualified type name</a> in the JSON file.</p>
<h1 id="example-json-type-file">Example JSON Type File</h1>
<p>Example of a types JSON file:</p>
<pre><code class="json">{
    &quot;registerTypes&quot; : [
        &quot;Fungus.Block&quot;
    ],
    &quot;extensionTypes&quot; : [
        &quot;Fungus.LuaExtensions&quot;
    ]
}
</code></pre>

<h1 id="registering-types-directly">Registering Types Directly</h1>
<p>If you need to register types directly from C#, or do a more complex type of registration, you can use the MoonSharp UserData class to do this. See the MoonSharp documentation for a list of supported registration methods. A good place to register C# types is in the Awake method of a custom component.</p>
<h1 id="other-utilities">Other Utilities</h1>
<p>LuaUtils creates bindings for several useful C# classes and components so that you can access them from Lua script.</p>
<table>
<thead>
<tr>
<th>Binding name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>time</td>
<td>The <a href="http://docs.unity3d.com/ScriptReference/Time.html">Unity Time class</a>. e.g. 'time.deltaTime' returns the delta time for this frame</td>
</tr>
<tr>
<td>playerprefs</td>
<td>The <a href="../preferences/index.html#playerprefs">Unity PlayerPrefs</a> class. Used for saving data to disk.</td>
</tr>
<tr>
<td>prefs</td>
<td>The <a href="../preferences/index.html#fungusprefs">FungusPrefs class</a>, our own wrapper around PlayerPrefs that adds a slots systems.</td>
</tr>
<tr>
<td>factory</td>
<td>The <a href="index.html#podfactory">PODTypeFactory</a> class for creating common plain-old-data types</td>
</tr>
<tr>
<td>luaenvironment</td>
<td>The LuaEnvironment component used to execute Lua scripts</td>
</tr>
<tr>
<td>luautils</td>
<td>A reference to the LuaUtils component itself</td>
</tr>
<tr>
<td>test</td>
<td>Support for <a href="../unity_test_tools/index.html">Unity Test Tools</a> (if installed)</td>
</tr>
<tr>
<td>stringtable</td>
<td>The FungusLua localisation <a href="../string_table/index.html">string table</a></td>
</tr>
</tbody>
</table>
<h1 id="podfactory">PODFactory</h1>
<p>Due to limitations in C# / Mono, MoonSharp has limited support for working with Plain-Old-Data (struct) types like <a href="http://docs.unity3d.com/ScriptReference/Vector3.html">Vector3</a>, <a href="http://docs.unity3d.com/ScriptReference/Color.html">Color</a>, etc. </p>
<p>The best approach here is to treat POD properties as immutable objects, and never try to modify a POD variable that has been acquired from a C# object. Instead, you should construct a new POD object, populate it with the required values and then pass that object in calls to C# code. The LuaUtils PODFactory class helps do this for common Unity types.</p>
<pre><code class="lua">-- Returns a new Color object
local c = luautils.factory.color(1,1,1,1)

-- Returns a new Vector2 object
local v2 = luautils.factory.vector2(1, 2)

-- Returns a new Vector3 object
local v3 = luautils.factory.vector3(1, 2, 3)

-- Returns a new Vector4 object
local v4 = luautils.factory.vector4(1, 2, 3, 4)

-- Returns a new Quaternion object
local q = luautils.factory.quaternion(float x, float y, float z) -- Rotation in euler angles

-- Returns a new Rect object
local r = luautils.factory.rect(float x, float y, float width, float height)
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>