<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://fungusgames.com/fungus_lua/controlling_fungus/index.html">
        <link rel="shortcut icon" href="../../images/favicon.ico">
        

	<title>Controlling Fungus - Fungus</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-70024522-1', 'auto');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" style="padding: 2px 0px 2px 0px;" href="../../index.html"><img src="../../images/logo_100.png" style='height: 50px;'></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Fungus Docs <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../index.html">Overview</a>
</li>

                    
                        
<li >
    <a href="../../about/index.html">What is Fungus?</a>
</li>

                    
                        
<li >
    <a href="../../download/index.html">Installation</a>
</li>

                    
                        
<li >
    <a href="../../getting_started/index.html">Getting Started</a>
</li>

                    
                        
<li >
    <a href="../../flowcharts/index.html">Flowcharts</a>
</li>

                    
                        
<li >
    <a href="../../blocks/index.html">Blocks</a>
</li>

                    
                        
<li >
    <a href="../../telling_a_story/index.html">Telling a Story</a>
</li>

                    
                        
<li >
    <a href="../../playing_audio/index.html">Playing Audio</a>
</li>

                    
                        
<li >
    <a href="../../articles/index.html">Community Articles</a>
</li>

                    
                        
<li >
    <a href="../../glossary/index.html">Glossary</a>
</li>

                    
                        
<li >
    <a href="../../faq/index.html">FAQ</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Reference</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../commands/animation_commands/index.html">Animation Commands</a>
</li>

        
            
<li >
    <a href="../../commands/audio_commands/index.html">Audio Commands</a>
</li>

        
            
<li >
    <a href="../../commands/camera_commands/index.html">Camera Commands</a>
</li>

        
            
<li >
    <a href="../../commands/flow_commands/index.html">Flow Commands</a>
</li>

        
            
<li >
    <a href="../../commands/itween_commands/index.html">iTween Commands</a>
</li>

        
            
<li >
    <a href="../../commands/narrative_commands/index.html">Narrative Commands</a>
</li>

        
            
<li >
    <a href="../../commands/scripting_commands/index.html">Scripting Commands</a>
</li>

        
            
<li >
    <a href="../../commands/sprite_commands/index.html">Sprite Commands</a>
</li>

        
            
<li >
    <a href="../../commands/variable_commands/index.html">Variable Commands</a>
</li>

        
            
<li >
    <a href="../../commands/event_handlers/core_events/index.html">Events (Core) Commands</a>
</li>

        
            
<li >
    <a href="../../commands/event_handlers/input_events/index.html">Events (Input) Commands</a>
</li>

        
            
<li >
    <a href="../../commands/event_handlers/sprite_events/index.html">Events (Sprite) Commands</a>
</li>

        
            
<li >
    <a href="../../advanced/narrative_parser_tokens/index.html">Narrative Parser Tokens</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">FungusLua Docs <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../index.html">Overview</a>
</li>

                    
                        
<li >
    <a href="../create_menu/index.html">Create Menu</a>
</li>

                    
                        
<li >
    <a href="../lua_environment/index.html">Lua Environment</a>
</li>

                    
                        
<li >
    <a href="../lua_bindings/index.html">Lua Bindings</a>
</li>

                    
                        
<li >
    <a href="../lua_script/index.html">Lua Script</a>
</li>

                    
                        
<li >
    <a href="../lua_utils/index.html">Lua Utils</a>
</li>

                    
                        
<li >
    <a href="../fungus_module/index.html">Fungus Module</a>
</li>

                    
                        
<li class="active">
    <a href="index.html">Controlling Fungus</a>
</li>

                    
                        
<li >
    <a href="../execute_lua/index.html">ExecuteLua command</a>
</li>

                    
                        
<li >
    <a href="../preferences/index.html">Preferences</a>
</li>

                    
                        
<li >
    <a href="../lua_store/index.html">Lua Store</a>
</li>

                    
                        
<li >
    <a href="../string_table/index.html">String Table</a>
</li>

                    
                        
<li >
    <a href="../unity_test_tools/index.html">Unity Test Tools</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../tutorial_videos/index.html">Tutorial Videos</a>
                </li>
            
            
            
                <li >
                    <a href="../../training_course/index.html">Training Course</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://fungusgames.com">FungusGames.com</a>
                </li>
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <!--
                <li >
                    <a rel="next" href="../fungus_module/index.html">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../execute_lua/index.html">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                -->
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#controlling-fungus">Controlling Fungus</a></li>
        
    
        <li class="main "><a href="#narrative-example">Narrative example</a></li>
        
    
        <li class="main "><a href="#say-dialog-functions">Say Dialog functions</a></li>
        
    
        <li class="main "><a href="#portrait-functions">Portrait functions</a></li>
        
    
        <li class="main "><a href="#menu-dialog-functions">Menu Dialog functions</a></li>
        
    
        <li class="main "><a href="#flowchart-functions">Flowchart functions</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="controlling-fungus">Controlling Fungus</h1>
<p>The Fungus module provides several functions for working with the standard Fungus narrative features and flowcharts.</p>
<p>You can control Say and Menu dialogs in much the same way you use Say and Menu commands in a normal Fungus flowchart.</p>
<p>When you use the menu() function, you supply another Lua function to call when that menu option is selected. Make sure to define the function higher up in the file before referencing it in a menu() call. If you don't explicitly set a SayDialog or MenuDialog object to use default ones are created automatically.</p>
<h1 id="narrative-example">Narrative example</h1>
<p>This example Lua script demonstrates some of the Say and Menu dialog functions. To try it out, add a Lua object to the scene (Tools &gt; Fungus &gt; Create &gt; Lua) and copy this script into the Lua Script text box. You may also need to add an EventSystem object in the scene (GameObject &gt; UI &gt; Event System) so that the menu buttons will respond to user input.</p>
<pre><code class="lua">say(&quot;Hi there&quot;)
say &quot;This syntax also works for say commands&quot;

-- Lua functions are the equivalent of Fungus blocks
-- Note that in Lua functions must be defined before they are called.

function goleft()
    say(&quot;You chose left&quot;)
end

function goright()
    say(&quot;You chose right&quot;)
end

menu(&quot;Go Left&quot;, goleft)
menu(&quot;Go right&quot;, goright)
</code></pre>

<h1 id="say-dialog-functions">Say Dialog functions</h1>
<p>To use a custom SayDialog:</p>
<ol>
<li>Add as SayDialog to the scene (Tools &gt; Fungus &gt; Create &gt; SayDialog)</li>
<li>Select the Lua object in the hierarchy and find the LuaBindings component.</li>
<li>Add a binding to the SayDialog game object, and select the SayDialog component. N.B. Make sure to select the correct component!</li>
<li>In Lua script, you can now activate this SayDialog using the setsaydialog() function, by passing the key of the SayDialog binding.</li>
</ol>
<p>To change the behaviour of the say() function, e.g. to not wait for input when done, do:</p>
<pre><code class="lua">sayoptions.waitforinput = false
</code></pre>

<p>You can bind Character objects in a similar fashion, and set the speaking character using the setcharacter() function.</p>
<p>This is the list of available functions for controlling SayDialogs.</p>
<pre><code class="lua">-- Options for configuring Say Dialog behaviour
sayoptions.clearprevious = true | false
sayoptions.waitforinput = true | false
sayoptions.fadewhendone = true | false
sayoptions.stopvoiceover = true | false

-- Set the active saydialog to use with the say function
-- saydialog: A binding to a SayDialog component
setsaydialog(saydialog)

-- Gets the active say dialog, or creates one if none exists yet
getsaydialog()

-- Set the active character on the Say Dialog
-- character: A Fungus.Character component
-- portrait: The name of a sprite in the character's portrait list
setcharacter(character, portrait)

-- Write text to the active Say Dialog
-- text: A string to write to the say dialog
-- voice: A voiceover audioclip to play
say(text, voiceclip)
</code></pre>

<h1 id="portrait-functions">Portrait functions</h1>
<p>Stage portraits can be controlled by using the stage.</p>
<p>First, add your characters and stage to the LuaBindings list.</p>
<p><img alt="Lua Stage Binding" src="../images/lua_stage_binding.png" /></p>
<p>Then, in a lua script, use the stage commands show, showPortrait and hide to control the portraits on stage.</p>
<pre><code class="lua">-- Show a character at this stage position
stage.show(character, &quot;left&quot;)

-- show a character with a specific portrait and move it
-- from one stage position to another.
stage.show(character, &quot;happy&quot;, &quot;offscreen right&quot;, &quot;right&quot;)

-- show a specific portrait
stage.showPortrait(character, &quot;amused&quot;)

-- hide a character
stage.hide(character)

-- Hide a character fading out to a position
stage.hide(character, &quot;offscreen left&quot;)
</code></pre>

<p>You can also specify any Portrait option available by using named arguments.</p>
<pre><code class="lua">stage.show{character=character, fromPosition=&quot;left&quot;, toPosition=&quot;right&quot;}

stage.show{character=character, portrait=&quot;angry&quot;}

stage.hide{character=character}
</code></pre>

<h1 id="menu-dialog-functions">Menu Dialog functions</h1>
<p>You setup custom MenuDialogs in the same manner as SayDialogs. This is the list of available MenuDialog functions.</p>
<pre><code class="lua">-- Set the active menudialog to use with the menu function
setmenudialog(menudialog)

-- Gets the active menu dialog, or creates one if none exists yet
getmenudialog()

-- Display a menu button
-- text: text to display on the button
-- callback: function to call when this option is selected
-- interactive (optional): if false, displays the option as disabled
menu(text, callback, interactive)

-- Display a timer during which the player has to choose an option.
-- duration: The length of time to display the timer.
-- callback: Function to call if the timer expires before an option is selected.
menutimer(duration, callback)

-- Clear all currently displayed menu options
clearmenu()
</code></pre>

<h1 id="flowchart-functions">Flowchart functions</h1>
<p>We've added special functions for say() and menu() because these are so common in Fungus games. To execute any other commands in Fungus from Lua, you must do it in conjunction with a Flowchart &amp; Block, like this:</p>
<ol>
<li>Add a Flowchart and a Block (e.g. "MyBlock") in the scene.</li>
<li>Add the Fungus commands you want to execute from Lua in the Block. (e.g Play Sound)</li>
<li>Add a Lua object to the scene (Tools &gt; Fungus &gt; Create &gt; Lua)</li>
<li>In the LuaBindings component, add a binding to the Flowchart gameobject, and select the Flowchart component.</li>
<li>In the LuaScript component, use the runblock() function to execute the Block, passing the bound flowchart and name of the block as parameters.</li>
</ol>
<pre><code class="lua">runblock(flowchart, &quot;MyBlock&quot;)
</code></pre>

<p>You can also access any Flowchart variable from Lua via the getvar() function.</p>
<pre><code class="lua">-- Assume the 'flowchart' variable is bound to a Flowchart component in LuaBindings
-- MyVar is a string variable defined on the Flowchart

local myvar = getvar(flowchart, &quot;MyVar&quot;)

print(myvar.value)

myvar.value = &quot;New value for string&quot;
</code></pre>

<p>This is the list of available functions for controlling Flowcharts.</p>
<pre><code class="lua">-- Returns the specified Variable in a Flowchart.
-- To access the value of the variable, use its .value property. e.g.
--  v = getvar(flowchart, &quot;FloatVar&quot;)
--  v.value = 10    -- Sets the value of the variable to 10
--  f = v.value     -- f now contains 10
-- flowchart: The Fungus Flowchart containing the Block to run.
-- varname: The name of the Variable to get.
getvar(flowchart, varname)

-- Runs the specified Block in a Flowchart
-- flowchart: The Fungus Flowchart containing the Block to run.
-- blockname: The name of the Block to run.
-- commandindex: Index of the command to start execution at
-- nowait: If false, will yield until the Block finishes execution. If true will continue immediately.
runblock(flowchart, blockname, commandindex, nowait)
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>