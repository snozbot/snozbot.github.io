<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Fungus: lua_controlling_fungus.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-59839218-1', 'auto');
  ga('send', 'pageview');
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color: #B7CEEC;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://fungusgames.com" target="_blank"><img alt="Logo" src="logo_small.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><!--Fungus-->
   &#160;<span id="projectnumber"><!--v3.6.1--></span>
   </div>
   <div id="projectbrief">v3.6.1 Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lua__controlling__fungus_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">lua_controlling_fungus.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lua__controlling__fungus_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Controlling %Fungus # {#lua_controlling_fungus}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;[TOC]</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;The %Fungus module provides several functions for working with the standard %Fungus narrative features and flowcharts.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;You can control Say and Menu dialogs in much the same way you use Say and Menu commands in a normal %Fungus flowchart.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;When you use the menu() function, you supply another Lua function to call when that menu option is selected. Make sure to define the function higher up in the file before referencing it in a menu() call. If you don&#39;t explicitly set a SayDialog or MenuDialog object to use default ones are created automatically.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# Narrative example # {#narrative_example}</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;This example Lua script demonstrates some of the Say and Menu dialog functions. To try it out, add a Lua object to the scene (Tools &gt; %Fungus &gt; Create &gt; Lua) and copy this script into the Lua Script text box. You may also need to add an EventSystem object in the scene (GameObject &gt; UI &gt; Event System) so that the menu buttons will respond to user input.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;```lua</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;-- Display text in a SayDialog</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;say(&quot;Hi there&quot;)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;say &quot;This syntax also works for say commands&quot;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;-- Display a list of options in a MenuDialog</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;-- (Note the curly braces here!)</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;local choice = choose{ &quot;Go left&quot;, &quot;Go right&quot; }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;if choice == 1 then</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    say(&quot;You chose left&quot;)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;elseif choice == 2 then</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    say(&quot;You chose right&quot;)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;end</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;```</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;Note: The curly braces syntax means that the list of options is passed as a single table parameter to the choose() function. It&#39;s a shortcut for writing this:</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;```lua</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;local choice = choose( {&quot;Go left&quot;, &quot;Go right&quot;} )</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;```</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;# Say Dialog functions # {#say_dialog_functions}</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;To use a custom SayDialog:</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;1. Add as SayDialog to the scene (Tools &gt; %Fungus &gt; Create &gt; SayDialog)</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;2. Select the Lua object in the hierarchy and find the LuaBindings component.</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;3. Add a binding to the SayDialog game object, and select the SayDialog component. N.B. Make sure to select the correct component!</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;4. In Lua script, you can now activate this SayDialog using the setsaydialog() function, by passing the key of the SayDialog binding.</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;To change the behaviour of the say() function, e.g. to not wait for input when done, do this:</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;```lua</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;sayoptions.waitforinput = false</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;```</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;You can bind Character objects in a similar fashion, and set the speaking character using the setcharacter() function.</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;This is the list of available functions for controlling SayDialogs.</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;```lua</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;-- Options for configuring Say Dialog behaviour</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;sayoptions.clearprevious = true | false</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;sayoptions.waitforinput = true | false</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;sayoptions.fadewhendone = true | false</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;sayoptions.stopvoiceover = true | false</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;-- Set the active saydialog to use with the say function</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;-- saydialog: A binding to a SayDialog component</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;setsaydialog(saydialog)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;-- Gets the active say dialog, or creates one if none exists yet</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;getsaydialog()</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;-- Set the active character on the Say Dialog</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;-- character: A Fungus.Character component</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;-- portrait: The name of a sprite in the character&#39;s portrait list</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;setcharacter(character, portrait)</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;-- Write text to the active Say Dialog</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;-- text: A string to write to the say dialog</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;-- voice: A voiceover audioclip to play</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;say(text, voiceclip)</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;```</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;# Menu Dialog functions # {#menu_dialog_functions}</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;You setup custom MenuDialogs in the same manner as SayDialogs, use the setmenudialog() function to set the active MenuDialog.</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;The easiest way to display a list of options is using the choose() function. Remember that in Lua array indices start at 1 instead of 0 like in most other languages.</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;You can set an option to be displayed but not selectable by prepending it with the ~ character.</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;```lua</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;local choice = choose { &quot;Option 1&quot;, &quot;Option 2&quot;, &quot;~Option 3&quot; } </div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;if choice == 1 then </div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   say &quot;Chose option 1&quot;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;elseif choice == 2 then </div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   say &quot;Chose option 2&quot;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;end</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;-- Option 3 is displayed but can&#39;t be selected</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;say &quot;End options&quot;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;```</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;A useful pattern is to use choose() together with Lua&#39;s goto statement and labels. This can be handy for &#39;flattening out&#39; nested menu options. The [goto statement] doesn&#39;t support jumping into the scope of a local variable, but it&#39;s easy to work around this by declaring the local variable in the outer scope. You could also use a global variable (by not using the local keyword).</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;```lua</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;local choice = 0</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;choice = choose { &quot;Option A&quot;, &quot;Option B&quot; } </div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;if choice == 1 then goto optionA end</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;if choice == 2 then goto optionB end</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;::optionA::</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;say &quot;Chose option A&quot;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;goto endoptions</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;::optionB::</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;choice = choose { &quot;Option C&quot;, &quot;Option D&quot; } </div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;if choice == 1 then goto optionC end</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;if choice == 2 then goto optionD end</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;goto endoptions</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;::optionC::</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;say &quot;Chose option C&quot;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;goto endoptions</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;::optionD::</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;say &quot;Chose option D&quot;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;goto endoptions</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;::endoptions::</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;say &quot;End options&quot;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;```</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;The menu() and menutimer() functions provide an alternative way to use the MenuDialog. These functions return immediately, and a callback function is called when the player selects an option from the menu.</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;This is the list of available MenuDialog functions.</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;```lua</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;-- Set the active menudialog to use with the menu function</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;setmenudialog(menudialog)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;-- Gets the active menu dialog, or creates one if none exists yet</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;getmenudialog()</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;-- Display a list of menu options and wait for user to choose one.</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;-- When an option starts with the ~ character it will be displayed but not be selectable.</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;-- Returns the index of the selected option.</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;-- Returns 0 if options list is empty. Note: Lua array indices start at 1, not 0).</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;-- options: an array of option strings. e.g. { &quot;Option 1&quot;, &quot;Option 2&quot; }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;choose(options)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;-- Display a list of menu options and wait for user to choose one, or for a timer to expire.</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;-- When an option starts with the ~ character it will be displayed but not be selectable.</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;-- Returns the index of the selected option, or the defaultoption if the timer expires.</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;-- Returns 0 if options list is empty. Note: Lua array indices start at 1, not 0).</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;-- options: an array of option strings. e.g. { &quot;Option 1&quot;, &quot;Option 2&quot; }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;-- duration: Time player has to pick an option.</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;-- defaultoption: Option index to return if the timer expires.</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;choosetimer(options, duration, defaultoption)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;-- Display a menu button</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;-- text: text to display on the button</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;-- callback: function to call when this option is selected</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;-- interactive (optional): if false, displays the option as disabled</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;menu(text, callback, interactive)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;-- Display a timer during which the player has to choose an option.</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;-- duration: The length of time to display the timer.</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;-- callback: Function to call if the timer expires before an option is selected.</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;menutimer(duration, callback)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;-- Clear all currently displayed menu options</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;clearmenu()</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;```</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;# Portrait functions # {#portrait_functions}</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;Stage portraits can be controlled by using the stage.</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;First, add your characters and stage to the LuaBindings list.</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;![Lua Stage Binding]</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;Then, in a lua script, use the stage commands show, showPortrait and hide to control the portraits on stage.</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;```lua</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;-- Show a character at this stage position</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;stage.show(character, &quot;left&quot;)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;-- show a character with a specific portrait and move it</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;-- from one stage position to another.</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;stage.show(character, &quot;happy&quot;, &quot;offscreen right&quot;, &quot;right&quot;)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;-- show a specific portrait</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;stage.showPortrait(character, &quot;amused&quot;)</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;-- hide a character</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;stage.hide(character)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;-- Hide a character fading out to a position</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;stage.hide(character, &quot;offscreen left&quot;)</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;```</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;You can also specify any Portrait option available by using named arguments.</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;```lua</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;stage.show{character=character, fromPosition=&quot;left&quot;, toPosition=&quot;right&quot;}</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;stage.show{character=character, portrait=&quot;angry&quot;, facing=&quot;left&quot;}</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;stage.hide{character=character}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;```</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;# Conversation function # {#conversation_function}</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;The conversation() function allows you to perform long dialogue exchanges with a single function call. Lua&#39;s multiline string syntax [[ ]] is handy here. As the conversation() function takes a single string parameter you can also omit the usual function parentheses.</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;```text</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;conversation [[</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;john: Hello!</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;sherlock: Greetings.</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;]]</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;```</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;See the docs for the @ref conversation_system.</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;# Flowchart functions # {#flowchart_functions}</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;We&#39;ve added special functions for say() and menu() because these are so common in %Fungus games. To execute any other commands in %Fungus from Lua, you must do it in conjunction with a Flowchart &amp; Block, like this:</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;1. Add a Flowchart and a Block (e.g. &quot;MyBlock&quot;) in the scene.</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;2. Add the %Fungus commands you want to execute from Lua in the Block. (e.g Play Sound)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;3. Add a Lua object to the scene (Tools &gt; %Fungus &gt; Create &gt; Lua)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;4. In the LuaBindings component, add a binding to the Flowchart gameobject, and select the Flowchart component.</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;5. In the LuaScript component, use the runblock() function to execute the Block, passing the bound flowchart and name of the block as parameters.</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;```lua</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;runblock(flowchart, &quot;MyBlock&quot;)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;```</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;You can also access any Flowchart variable from Lua via the getvar() function.</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;```lua</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;-- Assume the &#39;flowchart&#39; variable is bound to a Flowchart component in LuaBindings</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;-- MyVar is a string variable defined on the Flowchart</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;local myvar = getvar(flowchart, &quot;MyVar&quot;)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;print(myvar.value)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;myvar.value = &quot;New value for string&quot;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;```</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;This is the list of available functions for controlling Flowcharts.</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;```lua</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;-- Returns the specified Variable in a Flowchart.</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;-- To access the value of the variable, use its .value property. e.g.</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;--  v = getvar(flowchart, &quot;FloatVar&quot;)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;--  v.value = 10    -- Sets the value of the variable to 10</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;--  f = v.value     -- f now contains 10</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;-- flowchart: The Fungus Flowchart containing the Block to run.</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;-- varname: The name of the Variable to get.</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;getvar(flowchart, varname)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;-- Runs the specified Block in a Flowchart</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;-- flowchart: The Fungus Flowchart containing the Block to run.</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;-- blockname: The name of the Block to run.</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;-- commandindex: Index of the command to start execution at</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;-- nowait: If false, will yield until the Block finishes execution. If true will continue immediately.</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;runblock(flowchart, blockname, commandindex, nowait)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;```</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;[goto statement]: http://lua-users.org/wiki/GotoStatement</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;[Lua Stage Binding]: fungus_lua/lua_stage_binding.png</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="lua__controlling__fungus_8md.html">lua_controlling_fungus.md</a></li>
    <li class="footer">Generated on Tue Apr 3 2018 23:20:19 for Fungus by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
